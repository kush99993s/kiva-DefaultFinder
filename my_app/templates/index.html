
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- css links -->
    
    <!-- js links -->
    
    <title>Find defaulter</title>
    <!-- Bootstrap Core CSS -->

    <!-- Custom Fonts -->
    <link href="static/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css" />

    <script src="http://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js"></script>
        <link href="static/css/bootstrap.min.css" rel="stylesheet">
    <!-- MetisMenu CSS -->
    <link href="static/css/metisMenu.min.css" rel="stylesheet">
    <!-- Timeline CSS -->
    <link href="static/css/timeline.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="static/css/sb-admin-2.css" rel="stylesheet">
    <!-- Morris Charts CSS -->
    <link href="static/css/morris.css" rel="stylesheet">
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>\
    <style>
        .legend {
            line-height: 18px;
            color: #111;
        }
        .legend i {
            width: 18px;
            height: 18px;
            float: left;
            margin-right: 8px;
            opacity: 0.7;
        }
        .info {
            padding: 15px 15px;
            font: 10px/11px Arial, Helvetica, sans-serif;
            background: white;
            background: rgba(255,255,255,0.8);
            box-shadow: 0 0 10px rgba(1,1,1,0.2);
            border-radius: 10px;
        }
        .info h4 {
            margin: 1 1 10px;
            color: #777;
}
    </style>

   

</head>

<body>

    <div id="wrapper">

        <!-- Navigation -->
        <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">KivaSearchInfo</a>
            </div>
            <!-- /.navbar-header -->

            <ul class="nav navbar-top-links navbar-right">
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-envelope fa-fw"></i>  <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-messages">
                        <li>
                            <a href="#">
                                <div>
                                    <strong>John Smith</strong>
                                    <span class="pull-right text-muted">
                                        <em>Yesterday</em>
                                    </span>
                                </div>
                                <div>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque eleifend...</div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <strong>John Smith</strong>
                                    <span class="pull-right text-muted">
                                        <em>Yesterday</em>
                                    </span>
                                </div>
                                <div>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque eleifend...</div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <strong>John Smith</strong>
                                    <span class="pull-right text-muted">
                                        <em>Yesterday</em>
                                    </span>
                                </div>
                                <div>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque eleifend...</div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a class="text-center" href="#">
                                <strong>Read All Messages</strong>
                                <i class="fa fa-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                    <!-- /.dropdown-messages -->
                </li>
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-tasks fa-fw"></i>  <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-tasks">
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 1</strong>
                                        <span class="pull-right text-muted">40% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%">
                                            <span class="sr-only">40% Complete (success)</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 2</strong>
                                        <span class="pull-right text-muted">20% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 20%">
                                            <span class="sr-only">20% Complete</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 3</strong>
                                        <span class="pull-right text-muted">60% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%">
                                            <span class="sr-only">60% Complete (warning)</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 4</strong>
                                        <span class="pull-right text-muted">80% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%">
                                            <span class="sr-only">80% Complete (danger)</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a class="text-center" href="#">
                                <strong>See All Tasks</strong>
                                <i class="fa fa-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                    <!-- /.dropdown-tasks -->
                </li>
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-bell fa-fw"></i>  <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-alerts">
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-comment fa-fw"></i> New Comment
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-twitter fa-fw"></i> 3 New Followers
                                    <span class="pull-right text-muted small">12 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-envelope fa-fw"></i> Message Sent
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-tasks fa-fw"></i> New Task
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-upload fa-fw"></i> Server Rebooted
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a class="text-center" href="#">
                                <strong>See All Alerts</strong>
                                <i class="fa fa-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                    <!-- /.dropdown-alerts -->
                </li>
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-user fa-fw"></i>  <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-user">
                        <li><a href="#"><i class="fa fa-user fa-fw"></i> User Profile</a>
                        </li>
                        <li><a href="#"><i class="fa fa-gear fa-fw"></i> Settings</a>
                        </li>
                        <li class="divider"></li>
                        <li><a href="login.html"><i class="fa fa-sign-out fa-fw"></i> Logout</a>
                        </li>
                    </ul>
                    <!-- /.dropdown-user -->
                </li>
                <!-- /.dropdown -->
            </ul>
            <!-- /.navbar-top-links -->

            <div class="navbar-default sidebar" role="navigation">
                <div class="sidebar-nav navbar-collapse">
                    <ul class="nav" id="side-menu">
                        <li>
                            <a href="/map1"><i class="fa fa-dashboard fa-fw"></i> Modeling & result</a>
                        </li>
                       
                    </ul>
                </div>
                <!-- /.sidebar-collapse -->
            </div>
            <!-- /.navbar-static-side -->
        </nav>

        <div id="page-wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <h1 class="page-header"> Exploratory Data Analysis of KIVA</h1>
                </div>
                <!-- /.col-lg-12 -->
            </div>
      
            
            <!-- /.row -->
            <div class="row">
                <div class="col-lg-8">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <i class="fa fa-bar-chart-o fa-fw"></i> Normalized Default Rate
                            <div class="pull-right">
                                <div class="btn-group", id = "kush">
                                    <select id="cardtype" name="cards">
                                        <option value="selectcard">--- Please select ---</option>
                                        <option value="group_by_country">Group by Country</option>
                                        <option value="group_by_parter_id">Group by Parter ID</option>
                                        <option value="group_by_town">Group by Town</option>
                                     </select><br/>
                                    <div id="result"></div>
                                </div>
                            </div>
                        </div>
                        <script type="text/javascript">
                            $("select").change(function() {
                               
                                var val = $("#cardtype option:checked").val();
                               
                                if (val == 'group_by_country') {
                                    try{
                                       $('g').remove()
                                    }
                                    catch(err){}

                                    window.countryGeoJSON = {{ map_geo_json | safe }}

                                    
                                    function getColor(d) {
                                        return  d >= 0.2     ? '#800026' :
                                                d >= 0.1     ? '#BD0026' :
                                                d >= 0.05    ? '#E31A1C' :
                                                d >= 0.01    ? '#FC4E2A' :
                                                d >= 0.005   ? '#FD8D3C' :
                                                d >= 0.002   ? '#FEB24C' :
                                                d > 0       ? '#FED976' :
                                                              '#FFFF' ;
                                    }

                                    function style(feature) {
                                        return {
                                            fillColor: getColor(feature.density),
                                            weight: 2,
                                            opacity: 1,
                                            color: 'white',
                                            dashArray: '3',
                                            fillOpacity: 0.7
                                        };
                                    }
                                    function highlightFeature(e) {
                                        var layer = e.target;

                                        layer.setStyle({
                                            weight: 5,
                                            color: '#666',
                                            dashArray: '',
                                            fillOpacity: 0.7
                                        });

                                        if (!L.Browser.ie && !L.Browser.opera) {
                                            layer.bringToFront();
                                        }

                                        info.update(layer.feature.properties);
                                    }
                                    function resetHighlight(e) {
                                        geojson.resetStyle(e.target);
                                        info.update();
                                    }
                                        
                                    function zoomToFeature(e) {
                                        map.fitBounds(e.target.getBounds());
                                    }
                                    function onEachFeature(feature, layer) {
                                        layer.on({
                                            mouseover: highlightFeature,
                                            mouseout: resetHighlight,
                                            click: zoomToFeature
                                        });
                                    }
                                    geojson = L.geoJson(window.countryGeoJSON, {
                                        style: style,
                                        onEachFeature: onEachFeature
                                    }).addTo(map);

                                    legend = L.control({position: 'bottomright'});

                                    var info = L.control();

                                    info.onAdd = function (map) {
                                        this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
                                        this.update();
                                        return this._div;
                                    };

                                    // method that we will use to update the control based on feature properties passed
                                    info.update = function (props) {

                                        console.log ( props );
                                        this._div.innerHTML = '<h4>Normalized Default Rate</h4>' +  (props ?
                                            '<b>' + props.name + '</b><br />' + props.density.toFixed(4) * 100 
                                            : 'Hover over a state');
                                    };

                                    info.addTo(map);

                                    legend.onAdd = function (map) {

                                        var div = L.DomUtil.create('div', 'info legend'),
                                            grades = [20, 10, 5 ,1 , 0.5, 0.02, 0.005, 0 ],
                                            labels = [],
                                            from, to;

                                        for (var i = 0; i < grades.length; i++) {
                                            from = grades[i];
                                            to = grades[i + 1];

                                            labels.push(
                                                '<i style="background:' + getColor(from/100 ) + '"></i> ' +
                                                from + ('% >='));
                                        }

                                        div.innerHTML = labels.join('<br><br>');
                                        return div;
                                    };

                                    legend.addTo(map);
                                   //  function highlightFeature(e) {
                                   //          var layer = e.target;

                                   //          layer.setStyle({
                                   //              weight: 5,
                                   //              color: '#666',
                                   //              dashArray: '',
                                   //              fillOpacity: 0.7
                                   //          });

                                   //          if (!L.Browser.ie && !L.Browser.opera) {
                                   //              layer.bringToFront();
                                   //          }
                                   //  }
                                   
                                   // function zoomToFeature(e) {
                                   //      map.fitBounds(e.target.getBounds());
                                   //  } 

                                   //  function resetHighlight(e) {
                                   //      newLayer.resetStyle(e.target);
                                   //  }
                                    
                                   //  function onEachFeature(feature, layer) {
                                   //      layer.on({
                                   //          mouseover: highlightFeature,
                                   //          mouseout: resetHighlight,
                                   //          click: zoomToFeature
                                   //      });
                                   //  }
                                    
                                    // {} {onEachFeature: onEachFeature}
                                    // newLayer = L.geoJson(window.countryGeoJSON, {style: style} ).addTo(map);
                                    // newLayer.on('click', onMapClick);
                                
                                }else if (val == 'group_by_parter_id'){
                                    try{
                                        map.removeLayer(geojson);
                                        map.removeControl(legend);
                                    }catch(err){}

                                    {% for index in range(0, 376)%}
                                        
                                        {% if normalized_default[index] > 0%}
                                            circle = L.circle([{{lat[index]}}, {{long_[index]}}], 3000000*{{normalized_default[index]}}, {
                                                color: 'red',
                                                fillColor: 'NONE',
                                                fillOpacity: 0.5
                                            }).addTo(map);
                                            circle.bindPopup('{{"parter id: ", parter_id[index], "default rate: ",normalized_default[index] }}');
                                            
                                            circle.on('mouseover', function (e) {
                                                this.openPopup();
                                            });

                                            circle.on('mouseout', function (e) {
                                                this.closePopup();
                                            });
                                        {% endif %}
                                    {% endfor %}
                                }
                            });

                        </script>
                        <!-- /.panel-heading -->
                        <div class="panel-body">
                            <div id = "map" style="width: 1000px; height: 800px">
                                    </div>
                            
                            <!-- <div id="morris-area-chart"></div> -->
                        </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <i class="fa fa-bar-chart-o fa-fw"></i> Bar Chart Example
                            <div class="pull-right">
                                <div class="btn-group">
                                    <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown">
                                        Actions
                                        <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu pull-right" role="menu">
                                        <li><a href="#">Action</a>
                                        </li>
                                        <li><a href="#">Another action</a>
                                        </li>
                                        <li><a href="#">Something else here</a>
                                        </li>
                                        <li class="divider"></li>
                                        <li><a href="#">Separated link</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <!-- /.panel-heading -->
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-lg-4">
                                    <div class="table-responsive">
                                       
                                    </div>
                                    <!-- /.table-responsive -->
                                </div>
                                <!-- /.col-lg-4 (nested) -->
                                <div class="col-lg-8">
                                    <div id="morris-bar-chart"></div>
                                </div>
                                <!-- /.col-lg-8 (nested) -->
                            </div>
                            <!-- /.row -->
                        </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                    
                <!-- /.col-lg-8 -->
                
                <!-- /.col-lg-4 -->
            </div>
            <!-- /.row -->
        </div>
        <!-- /#page-wrapper -->

    </div>
    <!-- /#wrapper -->

    <!-- jQuery -->
    <script src="static/js/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="static/js/bootstrap.min.js"></script>

    <!-- Metis Menu Plugin JavaScript -->
    <script src="static/js/metisMenu.min.js"></script>

    <!-- Morris Charts JavaScript -->
    <script src="static/js/raphael-min.js"></script>
    <script src="static/js/morris.min.js"></script>
    <script src="static/js/morris-data.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="static/js/sb-admin-2.js"></script>
    <script>
        window.latlong =[]
        map = L.map('map').setView([-100, -100], 4); // 4 here is magnification level shown in first time

        L.tileLayer('https://{s}.tiles.mapbox.com/v3/{id}/{z}/{x}/{y}.png', {
            maxZoom: 22 , // how mnay time you can magnify from largest map. After 22 zoom, map is not working due to more magnificaiton
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
                '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
            id: 'examples.map-i875mjb7'
        }).addTo(map);
        
        
        
        var popup = L.popup();

        function onMapClick(e) {
            popup.setLatLng(e.latlng)
                 .setContent("You clicked the map at " + e.latlng.toString())
                 .openOn(map);
            window.latlong.push(e.latlng);}
        map.on('click', onMapClick);


       
                              
    
        </script>
                                    

</body>

</html>
